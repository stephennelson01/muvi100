<!DOCTYPE html>
<html>
  <head>
    <title>muvi100</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Styles -->
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "auth",    "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "site",    "data-turbo-track": "reload" %>

    <%= javascript_importmap_tags %>
  </head>

  <!-- Mount modal controller here so header buttons can reach it -->
  <body class="bg-neutral-900 text-neutral-100" data-controller="modal">
    <!-- Header -->
    <header class="sticky top-0 z-40 bg-neutral-900/80 backdrop-blur-md border-b border-neutral-800 shadow-[0_1px_0_0_rgba(255,255,255,0.04)]">
      <div class="max-w-7xl mx-auto px-4">
        <div class="h-14 flex items-center justify-between gap-3">
          <!-- Brand -->
          <%= link_to root_path, class: "flex items-center gap-2 group", "aria-label": "muvi100 home" do %>
            <span class="inline-grid place-items-center w-9 h-9 rounded-xl bg-gradient-to-br from-red-500 to-amber-400 ring-1 ring-white/10">
              <span class="font-black text-white tracking-tight">M</span>
            </span>
            <span class="font-extrabold tracking-wide text-white text-lg leading-none">
              MUVI
              <span class="bg-gradient-to-r from-red-500 to-amber-300 bg-clip-text text-transparent">100</span>
            </span>
          <% end %>

          <!-- Tabs -->
          <nav class="hidden md:flex items-center gap-1">
            <% tabs = [
              ["Home",      root_path],
              ["Trending",  trending_path],
              ["Movies",    movies_path],
              ["TV Series", tv_index_path],
              ["Genres",    genres_path],
              ["Anime",     anime_path]
            ] %>
            <% tabs.each do |label, path| %>
              <%= link_to label, path,
                  class: "px-3 py-2 rounded-md text-sm font-medium transition #{ current_page?(path) ? 'bg-white/10 text-white underline underline-offset-4 decoration-red-500' : 'text-neutral-200 hover:text-red-500 hover:underline hover:underline-offset-4 hover:decoration-red-500' }" %>
            <% end %>
          </nav>

          <!-- Search -->
          <%= form_with url: search_path, method: :get, class: "hidden sm:block" do %>
            <input name="q" placeholder="Search movies & TV…"
                   class="w-64 bg-neutral-800 text-neutral-100 placeholder-neutral-400 px-3 py-2 rounded-md border border-neutral-700 focus:outline-none focus:ring-1 focus:ring-white/40" />
          <% end %>

          <!-- Auth -->
          <div class="flex items-center gap-2">
            <% if user_signed_in? %>
              <%= link_to "Bookmarks", bookmarks_path,
                    class: "text-sm bg-white text-neutral-900 px-3 py-1.5 rounded-md font-medium hover:bg-neutral-100" %>

              <%= button_to "Sign out", destroy_user_session_path,
                    method: :delete,
                    class: "text-sm bg-red-600 hover:bg-red-500 text-white px-3 py-1.5 rounded-md font-medium" %>
            <% else %>
              <!-- These now call the body-mounted controller -->
              <button type="button"
                      class="text-sm bg-neutral-700 hover:bg-neutral-600 text-white px-3 py-1.5 rounded-md font-medium"
                      data-action="click->modal#openSignIn">
                Sign In
              </button>

              <button type="button"
                      class="text-sm bg-red-600 hover:bg-red-500 text-white px-3 py-1.5 rounded-md font-medium"
                      data-action="click->modal#openSignUp">
                Sign Up
              </button>
            <% end %>
          </div>
        </div>
      </div>
    </header>

    <!-- Page -->
    <main class="py-6">
      <div class="max-w-7xl mx-auto px-4">
        <%= render "shared/flash" %>
        <%= yield %>
      </div>
    </main>

    <footer class="border-t border-neutral-800 py-6 text-center text-sm text-neutral-400">
      © <%= Time.current.year %> muvi100
    </footer>

    <!-- Auth Modal -->
    <%= render "shared/auth_modal" unless user_signed_in? %>
  </body>
</html>
