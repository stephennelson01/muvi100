<%# expects: item, and optional :current_user %>
<% title = item["title"] || item["name"] %>
<% poster = item["poster_path"] %>
<% vote   = item["vote_average"] %>
<% is_tv  = item["media_type"] == "tv" || item["first_air_date"].present? %>

<% path = is_tv ? tv_path(item["id"]) : movie_path(item["id"]) %>

<div class="group relative">
  <%= link_to path, class: "block rounded-lg overflow-hidden" do %>
    <% if poster.present? %>
      <img src="https://image.tmdb.org/t/p/w342<%= poster %>"
           alt="<%= title %>"
           class="w-full h-56 object-cover transition-transform duration-200 group-hover:scale-105">
    <% else %>
      <div class="w-full h-56 bg-neutral-800"></div>
    <% end %>
  <% end %>

  <% if vote.present? %>
    <div class="absolute bottom-2 left-2 bg-black/70 text-xs text-white px-2 py-1 rounded">
      ⭐ <%= sprintf('%.1f', vote) %>
    </div>
  <% end %>

  <!-- Bookmark toggle (inline) -->
  <% if current_user %>
    <% bm = current_user.bookmark_for(item["id"]) %>
    <div class="absolute top-2 right-2">
      <% if bm %>
        <%= button_to "★", bookmark_path(bm),
              method: :delete,
              class: "text-white text-xl leading-none hover:text-red-500 bg-black/50 rounded px-1" %>
      <% else %>
        <%= button_to "☆", bookmarks_path(media_id: item["id"], title: title, kind: (is_tv ? "tv" : "movie")),
              method: :post,
              class: "text-white text-xl leading-none hover:text-red-500 bg-black/50 rounded px-1" %>
      <% end %>
    </div>
  <% end %>

  <div class="mt-2 text-sm text-neutral-200 group-hover:text-white line-clamp-2">
    <%= title %>
  </div>
</div>
